# 分类数据

类别变量是统计信息中的一种变量，代表一组有限的且通常是固定的值。 这与连续变量相反，连续变量可以表示无限数量的值。 类别变量的常见类型包括性别（其中有两个值，分别是男性和女性）或血液类型（可以是一小批血液类型之一，例如 A，B 和 O）。

pandas 可以使用一种称为`Categorical`的 pandas 对象来表示分类变量。 这些熊猫对象旨在有效地表示分组为一组存储桶的数据，每个存储桶由代表其中一个类别的整数代码表示。 这些基础代码的使用使熊猫能够有效地表示类别集，并可以跨多个类别变量执行数据的排序和比较。

在本章中，我们将学习有关分类法的以下内容：

*   创建分类
*   重命名类别
*   追加新类别
*   删除类别
*   删除未使用的类别
*   设定类别
*   描述性统计
*   价值计数
*   最小，最大和模式
*   如何使用分类法根据学生的数字等级为学生分配字母等级

# 配置熊猫

我们使用以下导入和配置语句开始本章中的示例：

![](img/00277.jpeg)

# 创建分类

大熊猫类别用于表示类别变量。 分类变量由一组有限的值组成，通常用于将值映射到一组类别中，并跟踪每个类别中存在多少个值。 另一个目的是将连续值的各个部分映射到一组离散的命名标签中，其一个示例是将数字等级映射到字母等级。 在本章的最后，我们将研究如何执行这种映射。

有几种创建分类熊猫的方法。 以下屏幕截图演示了如何直接从列表创建分类：

![](img/00278.jpeg)

此分类是从包含五个字符串和三个不同值的列表创建的：低，中和高。 创建分类时，熊猫会确定列表中的每个唯一值并将其用作类别。

可以使用`.categories`属性检查以下类别：

![](img/00279.jpeg)

类别创建了一个索引，该索引由提供的列表中的三个不同值组成。

类别的值可以使用`.get_values()`检索：

![](img/00280.jpeg)

分类的每个类别都分配有一个整数值。 此值称为**代码**。 可以使用`.codes`属性访问这些分配的代码。

![](img/00281.jpeg)

这些代码有效地表示每个值在分类索引中的位置。 在这种情况下，映射是*低= 1* ，*高= 0* 和*中= 2* 。 此排序可能没有逻辑意义，由熊猫通过串行处理`lmh_values`数组中的字符串来确定。

通过使用`categories`参数指定类别，可以更好地控制此排序。

![](img/00282.jpeg)

请注意在构造函数中指定的类别的新顺序。 由于此顺序，代码现在为：

![](img/00283.jpeg)

现在，它表示低= 0，中= 1 和高= 2 的映射。这更加有用，因为它可用于按与每个类别的含义及其与其他类别的关系相匹配的顺序对值进行排序。 在分类分类时，将使用代码而不是实际值进行分类。 以下演示`lmh_cat`的排序：

![](img/00284.jpeg)

分类变量也可以表示为一个序列，其`dtype`被指定为`"category"`。 以下屏幕快照演示了如何获取类别列表并创建具有`dtype`类别的`Series`：

![](img/00285.jpeg)

使用分类创建`Series`的另一种方法是先创建`Series`，然后使用`.astype('category')`方法将一列转换为分类。 下面的屏幕截图通过创建一个数据框并将其值转换为“分类”的第二列来说明这一点，该数据框的一列然后是第二列。

![](img/00286.jpeg)

创建为分类的系列包含`.cat`属性，该属性允许访问`Series`使用的分类：

![](img/00287.jpeg)

该变量是`CategoricalAccessor`对象，它允许访问基础分类的各种属性。 例如，以下代码获取类别：

![](img/00288.jpeg)

几个熊猫函数还返回分类。 一种是`pd.cut()`，它会在特定值范围内创建对象箱。 以下屏幕截图演示了将代表`0`和`100`之间的`5`随机数的一系列值切入 10 个分类箱，每个箱子宽 10 个整数：

![](img/00289.jpeg)

![](img/00290.jpeg)

`Group`列表示由 cut 函数创建的类别变量，每个索引级别的值表示该值已与之关联的特定类别。

![](img/00291.jpeg)

可以使用`ordered = True`指定类别的显式顺序。 此信息意味着类别的顺序很重要，并且可以比较多个类别的分类变量中的值。 为了说明这一点，下面的代码创建了一个有序的分类，代表三种金属（以及这三个类别的四个值）：

![](img/00292.jpeg)

创建的分类具有`bronze`的严格排序，其重要性低于`silver`，而`silver`的重要性低于`gold`。

此排序可用于将一个分类分类或与另一个分类进行比较。 为了说明这一点，让我们创建以下类别，将其取反：

![](img/00293.jpeg)

这两个类别变量可以相互比较。 以下代码显示了每种金属是否比另一种分类中相同索引标签上的相应金属价值低：

![](img/00294.jpeg)

熊猫通过对每个值匹配基础代码来执行此比较。 金属变量具有以下代码：

![](img/00295.jpeg)

并且`metals_reveresed_values`具有以下代码。

![](img/00296.jpeg)

逻辑运算符的应用导致前面显示的结果。

作为创建分类的最后一个示例，以下屏幕截图演示了如何创建一个分类，该分类指定的值（`copper`）不是指定类别之一。 在这种情况下，大熊猫将用`NaN`代替该值。

![](img/00297.jpeg)

此技术可用于在创建时筛选出不适合分类的值。

# 重命名类别

通过为`.categories`属性分配新值或使用`.rename_categories()`方法，分类人员可以重命名值。

![](img/00298.jpeg)

![](img/00299.jpeg)

请注意，这是就地修改。 为了防止就地修改，我们可以使用`.rename_categories()`方法。

![](img/00300.jpeg)

我们可以验证这不是就地完成的。

![](img/00301.jpeg)

# 追加新类别

可以使用`.add_categories()`方法附加类别。 以下代码将`copper`类别添加到我们的金属中。 除非明确告知熊猫这样做，否则不会就地进行：

![](img/00302.jpeg)

# 删除类别

可以使用`.remove_categories()`方法删除类别。 删除的值将替换为`np.NaN`。 以下屏幕截图通过删除`bronze`类别来演示此操作：

![](img/00303.jpeg)

# 删除未使用的类别

可以使用`.remove_unused_categories()`删除未使用的类别，如下所示：

![](img/00304.jpeg)

# 设定类别

也可以使用`.set_categories()`方法在一个步骤中添加和删除类别。 鉴于以下`Series`：

![](img/00305.jpeg)

以下代码将类别设置为`"one"`和`"four"`：

![](img/00306.jpeg)

结果将`NaN`替换为现在不存在的类别。

# 分类的描述性信息

分类上的`.describe()`方法将以类似于`Series`或`DataFrame`的方式产生描述性统计信息。

![](img/00307.jpeg)

结果为我们提供了每个类别的实例数量以及每个类别的频率分布。

可以使用`.value_counts()`获得每个类别的值计数。

![](img/00308.jpeg)

最小值，最大值和模式值可以使用相应的方法找到。

![](img/00309.jpeg)

# 蒙文学校成绩

现在让我们看一下应用分类法来帮助我们根据类别而不是数字来组织信息。 我们将要研究的问题是根据学生的数字等级为其分配字母等级。

![](img/00310.jpeg)

该数据框代表每个学生的原始分数。 接下来，我们将数字等级分解为字母代码。 以下代码定义每个等级的箱以及每个箱的关联字母等级：

![](img/00311.jpeg)

使用这些值，我们可以执行分配字母等级的剪切。

![](img/00312.jpeg)

检查基础分类，将显示以下代码的创建方式以及字母等级与值的关系：

![](img/00313.jpeg)

要确定每个年级有多少学生，我们可以使用`.cat.value_counts()`：

![](img/00314.jpeg)

由于字母等级 Categorical 对字母等级具有逻辑顺序，因此我们可以使用它通过在“ Categorical”列上进行排序，从最高到最低字母等级对学生进行排序。

![](img/00315.jpeg)

# 摘要

在本章中，我们研究了如何使用 pandas Categoricals 对分类变量建模。 我们首先回顾了创建分类的方法，并查看了几个如何使用基础整数代码对每个类别进行分类的示例。 然后，我们研究了创建分类后修改分类的几种方法。 本章以使用分类将数据分解为一组命名容器的示例作为结尾。

在下一章中，我们将对熊猫数据进行数值和统计分析。